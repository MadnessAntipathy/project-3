<!-- Shows all items in cart -->

<% allitem = 0 %>
<table class="table table-striped">
	<thead>
  <tr>
  	<th scope="col">Item</th>
    <th scope="col">Qty</th>
    <th scope="col">Price</th>
    <th scope="col"></th>
  </tr>
	</thead>
	<tbody>

	  <% @carts.each do |cart| %>
	    <tr>
	    	  <td scope="row"><%= cart.item.name %></td>
	        <!-- <td><%= cart.item_quantity %></td> -->
	        <td><input data-cart-id = "<%= cart.id %>" id="itemqty" name="item_quantity" type="number" steps="1" min="1" max="10" value="<%= cart.item_quantity %>"></td>


	        <td><% allitem = cart.item.price * cart.item_quantity %>$<%= '%.2f' % allitem %></td>
	        <td><%= link_to 'Delete Item', delete_cart_path(cart),
	              method: :delete,
	              data: { confirm: 'Are you sure?' }, class:"btn btn-warning" %></td>
	    </tr>
	  <% end %>
	</tbody>
</table>



<%= form_with scope: :order, url: submit_path, local: true do |form| %>
  <p>
    <%= form.hidden_field :table_id, :value => session[:table] %>
  </p>
  <p>
    <% @carts.each do |cart| %>
    <%= form.hidden_field :item_ids,:multiple => true, :value => cart.item.id %>
    <%= form.hidden_field :item_quantities,:multiple => true, :value => cart.item_quantity %>
    <% end %>

  </p>
  <p>
    <%= form.submit "Submit order", class:"btn btn-outline-success" %>
  </p>
<% end %>

<%= link_to 'Back', items_path, class:"btn btn-secondary" %>

<script>
	  window.onload = function(){

	  	$("#itemqty").change(function(){
	  			// console.log($("#itemqty").val())
	  			var qty = $("#itemqty").val();
	  			var qtyname = quantity: qty;
	  			console.log("qty: " + qty);
	  			console.log(qtyname);
			    Rails.ajax({
			    	type: "PATCH",
			      url: `/carts/${$("#itemqty").attr("data-cart-id")}`,
			      data: {qtyname},

			      success: function(data, textStatus, xhr) {
			      	console.log(data)
			      },
			      error: function(xhr, textStatus, errorThrown) {}
			    })
			  })
  }

</script>